/* Copyright (c) Ericsson 2015 */

define("styles!widget/WfDefinitions/CreateWfInstanceForm/CreateWfInstanceForm.less",function(){return".eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm {\n  width: 99%;\n  padding-top: 8px ! important;\n  padding-right: 10px;\n  padding-bottom: 10px;\n}\n.eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-BottomDivider {\n  border-bottom: 1px solid #666666;\n  padding-top: 5px;\n}\n.eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-SectionHeading-Title {\n  float: left;\n}\n.eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-contentTable {\n  height: auto;\n  max-height: calc(100% - 80px);\n  overflow: auto;\n  width: calc(100% - 15px);\n}\n.eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-contentTable-buttonRefresh {\n  float: left;\n  vertical-align: bottom;\n  margin-left: 15px;\n  margin-top: 10px;\n  padding-top: 5px;\n  cursor: pointer;\n  cursor: hand;\n}\n.eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-Buttons {\n  padding-top: 10px;\n  background-color: #f2f2f2;\n  padding: 6px 0;\n  padding-left: 120px;\n  width: 245px;\n}\n"}),define("template!widget/WfDefinitions/CreateWfInstanceForm/CreateWfInstanceForm.html",["jscore/handlebars/handlebars"],function(t){return t.template(function(t,n,e,i,o){e=e||t.helpers;var a,s,r="",f="function",l=e.helperMissing,c=void 0,u=this.escapeExpression;return r+='<div class="eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm">    	\r\n	\r\n	<div class="ebLayout-SectionHeading eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-SectionHeading">\r\n        <div class="eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-SectionHeading-Title"><h2>Workflow Instances</h2>\r\n            <!-- <div class="eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-contentTable-buttonRefresh"><i class="ebIcon ebIcon_refresh"></i></div> -->\r\n        </div>\r\n    </div>\r\n 	<div class="eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-Panel">\r\n	    <div class="ebLayout-SectionSubheading">\r\n    	    <h3>Create Workflow Instance: ',s=e.workflowName,a=s||n.workflowName,typeof a===f?a=a.call(n,{hash:{}}):a===c&&(a=l.call(n,"workflowName",{hash:{}})),r+=u(a)+'</h3>\r\n    	</div>\r\n    	<div class="eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-FormContent"></div>\r\n 	</div>\r\n 	    	\r\n 	<div class="eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-Buttons">\r\n        <button type="button" class="ebBtn ebBtn_color_paleBlue eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-Buttons-buttonSubmit">Submit</button>\r\n        <button type="button" class="ebBtn ebBtn_wMargin eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-Buttons-buttonCancel">Cancel</button>\r\n 	</div>\r\n 	<div class="eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-BottomDivider"></div>\r\n</div>'})}),define("widget/WfDefinitions/CreateWfInstanceForm/CreateWfInstanceFormView",["jscore/core","template!./CreateWfInstanceForm.html","styles!./CreateWfInstanceForm.less"],function(t,n,e){return t.View.extend({getTemplate:function(){return n(this.options)},getStyle:function(){return e},getFormContent:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-FormContent")},getSubmitButton:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-Buttons-buttonSubmit")},getCancelButton:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitions-CreateWfInstanceForm-Buttons-buttonCancel")}})}),define("widget/WfDefinitions/CreateWfInstanceForm/CreateWfInstanceForm",["jscore/core","3pps/wfs/WfDefinitionClient","3pps/wfs/WfInstanceClient","../../WfForm/WfForm","../../ErrorDialog/ErrorDialog","./CreateWfInstanceFormView","jscore/ext/locationController"],function(t,n,e,i,o,a,s){return t.Widget.extend({view:function(){return this.workflowName=this.options.wfDefinitionModel.getAttribute("name"),new a({workflowName:this.workflowName})},onAttach:function(){this.createHandledCallback=this.options.createHandledCallback,this.wfDefinitionId=this.options.wfDefinitionModel.getAttribute("id"),n.getStartFormModelById({wfDefinitionId:this.wfDefinitionId,success:function(t){var n=this.view.getCancelButton();n.addEventHandler("click",function(){this.handleCancel(),this.options.regionEventBus&&(this.options.regionEventBus.publish("showHeader","showHeader"),this.options.regionEventBus.publish("showPagination","showPagination"))}.bind(this));var e=this.view.getSubmitButton();if(e.addEventHandler("click",function(){this.handleSubmit(t)}.bind(this)),null!=t)try{this.form=new i({formModel:t,variableCollection:null}),this.form.attachTo(this.view.getFormContent())}catch(o){this.handleError("Unable to build form for "+this.wfDefinitionId,[o])}this.options.minHeight&&this.getElement().setStyle("min-height","300px;")}.bind(this),error:function(t){this.handleError("Unable to retrieve form for "+this.wfDefinitionId,[t])}.bind(this)})},handleSubmit:function(t){var n=Object.create(null),i="";e.getTORUserId({success:function(o){i=o;var a=Object.create(null);if(a.value=i,a.required=!0,null!=t&&(t.toString().indexOf("\n")>-1||"json"!=t.attributes.formInfo.format)||this.form&&(n=this.form.getVariables()),n["tor-user-id"]=a,void 0!=n&&null!=n){var r=new s,f=(this.value,"workflowsinstances/"+this.options.wfDefinitionModel.getAttribute("id")+"/"+this.options.wfDefinitionModel.getAttribute("name"));r.setLocation(f),this.options.regionEventBus&&(this.options.regionEventBus.publish("showHeader","showHeader"),this.options.regionEventBus.publish("showPagination","showPagination"))}null!=n&&e.startInstanceById({wfDefinitionId:this.wfDefinitionId,variables:n,success:function(){var t=new s,n=(this.value,"workflowsinstances/"+this.wfDefinitionId+"/"+this.workflowName);t.setLocation(n),this.options.regionEventBus&&(this.options.regionEventBus.publish("showHeader","showHeader"),this.options.regionEventBus.publish("showPagination","showPagination")),this.createHandledCallback(!0)}.bind(this),error:function(t){this.handleError("Unable to start workflow instance for "+this.wfDefinitionId,[t])}.bind(this)})}.bind(this)})},handleCancel:function(){this.createHandledCallback(!1)},handleError:function(t,n){var e=" ";if(null!=n&&n.length>0)for(var i=0;i<n.length;i++)e+=n[i]+" ";new o({title:t,message:e}),this.createHandledCallback(!1)}})});