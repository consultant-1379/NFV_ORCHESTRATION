/* Copyright (c) Ericsson 2015 */

define("styles!widget/WfDefinitions/WfDefinitionsTable/WfDefinitionsTable.less",function(){return".eaNFE_automation_UI-WfDefinitionsTable-SectionHeading {\n  padding-top: 8px;\n}\n.eaNFE_automation_UI-WfDefinitionsTable-SectionHeading-Title {\n  float: left;\n}\n.eaNFE_automation_UI-WfDefinitionsTable-SectionHeading-Filter {\n  padding-top: 18px;\n  float: right;\n}\n.eaNFE_automation_UI-WfDefinitionsTable-contentTable {\n  min-height: auto;\n  max-height: 770px;\n}\n.eaNFE_automation_UI-WfDefinitionsTable-contentTable-buttonRefresh {\n  float: left;\n  vertical-align: bottom;\n  margin-left: 15px;\n  margin-top: 10px;\n  cursor: pointer;\n  cursor: hand;\n  padding-top: 5px;\n}\n.eaNFE_automation_UI-WfDefinitionsTable-contentTable-BottomDivider {\n  border-bottom: 1px solid #666666;\n  width: 100%;\n  padding-bottom: 5px;\n}\n"}),define("text!widget/WfDefinitions/WfDefinitionsTable/WfDefinitionsTable.html",function(){return'<div class="eaNFE_automation_UI-WfDefinitionsTable">\r\n	<div class="ebLayout-SectionHeading eaNFE_automation_UI-WfDefinitionsTable-SectionHeading">\r\n        <div class="eaNFE_automation_UI-WfDefinitionsTable-SectionHeading-Title"><h2>Workflow Definitions</h2>\r\n        	<div class="eaNFE_automation_UI-WfDefinitionsTable-contentTable-buttonRefresh"><i class="ebIcon ebIcon_refresh"></i></div>\r\n        </div>\r\n    </div>\r\n    <div class="eaNFE_automation_UI-WfDefinitionsTable-contentTable eb_scrollbar">   \r\n    </div>\r\n    <!-- <div class="eaNFE_automation_UI-WfDefinitionsTable-contentTable-Pagination"></div> -->\r\n    <!-- <div class="eaNFE_automation_UI-WfDefinitions-contentTable-buttonDiagram">\r\n		<i class="ebIcon eaNFE_automation_UI-WfDefinitions-contentTable-buttonIcon"></i>View Workflow</div> -->\r\n</div>\r\n'}),define("widget/WfDefinitions/WfDefinitionsTable/WfDefinitionsTableView",["jscore/core","text!./WfDefinitionsTable.html","styles!./WfDefinitionsTable.less"],function(t,e,i){return t.View.extend({getTemplate:function(){return e},getStyle:function(){return i},getTableContent:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitionsTable-contentTable")},getPagination:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitionsTable-contentTable-Pagination")},getDiagramButton:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitions-contentTable-buttonDiagram")},getRefreshButton:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitionsTable-contentTable-buttonRefresh")},getHeadingContent:function(){return this.getElement().find(".eaNFE_automation_UI-WfDefinitionsTable-SectionHeading")}})}),define("widget/WfDefinitions/WfDefinitionsTable/WfDefinitionsTable",["jscore/core","jscore/ext/mvp","./WfDefinitionsTableView","tablelib/Table","widgets/Pagination","3pps/wfs/WfDefinitionClient","3pps/wfs/WfCountsClient","jscore/ext/locationController","widgets/table/Row","tablelib/plugins/StickyHeader","tablelib/plugins/StickyScrollbar","tablelib/plugins/Selection","tablelib/plugins/SortableHeader","widget/WfDefinitions/CreateWfInstanceForm/CreateWfInstanceForm","./filterheadercell/FilterHeaderCell","./SecondHeader/SecondHeader"],function(t,e,i,n,o,a,s,l,r,f,c,d,h,b,u,g){var p={};return t.Widget.extend({View:i,init:function(){this.offset=this.options.offset?this.options.offset:0,this.limit=this.options.limit?this.options.limit:100},onViewReady:function(){function t(){var t=[];if(m.filterTableData){t=m.filterTableData.toJSON();for(var e in p){var i=p[e];t=t.filter(function(t){if(!p[e].value)return!0;switch(i.comparator){case"=":return t[e].indexOf(p[e].value)>-1||t[e].toLowerCase().indexOf(p[e].value.toLowerCase())>-1}})}}return t}function i(){this._inContext=!1,this.options.regionEventBus.publish("topsection:leavecontext")}function o(){this._inContext=!0,this.options.regionEventBus.publish("topsection:contextactions",[{type:"button",color:"blue",name:"Start Instance",action:s.bind(this)},{type:"separator"},{type:"link",icon:"tick",flat:!0,name:"View Diagram",action:a.bind(this)},{type:"separator"},{type:"link",icon:"tick",flat:!0,name:"View Instance Table",action:r.bind(this)}])}function a(){this.table.getSelectedRows().forEach(function(t){this.options.regionEventBus.publish("showdiagram",t.options.model),this.options.regionEventBus.publish("toggleHeadingOn","toggleHeaderOn")},this),i.call(this)}function s(){this.table.getSelectedRows().forEach(function(t){this.hidePagination(),this.view.getHeadingContent().setStyle("display","none"),this.table.detach();var i=new e.Model(t.options.model);this.showCreateInstanceForm(i)}.bind(this)),i.call(this)}function r(){this.table.getSelectedRows().forEach(function(t){var e=new l,i=(this.value,"workflowsinstances/"+t.options.model.id+"/"+t.options.model.name);e.setLocation(i)}),i.call(this)}var b=[{title:"Workflow",attribute:"name",width:"300px",sortable:!0,secondHeaderCellType:u},{title:"Version",attribute:"version",width:"100px",sortable:!0,secondHeaderCellType:u},{title:"Created",attribute:"createdOnStr",width:"130px",sortable:!0,secondHeaderCellType:u},{title:"Category",attribute:"category",sortable:!0,width:"100px",sortable:!0,secondHeaderCellType:u},{title:"Description",width:"350px",attribute:"description",secondHeaderCellType:u}];this.table=new n({plugins:[new d({selectableRows:!0,multiselect:!0}),new c,new f({topOffset:34}),new h,new g],selectableRows:!0,modifiers:["striped"],columns:b}),this.table.addEventHandler("filter",function(e,i,n){p[e]={value:i,comparator:n},this.table.setData(t())}.bind(this)),this.renderDefinitionTable();var m=this;this.table.addEventHandler("sort",function(t,e){this.table.setData(this.getSortedData(t,e))}.bind(this)),this.table.addEventHandler("rowselectend",function(t){t.length>0&&!this._inContext?o.call(this):0===t.length&&i.call(this)}.bind(this)),this.options.regionEventBus.subscribe("showHeader",function(t){this.view.getHeadingContent().setStyle("display","inline-block")}.bind(this)),this.options.regionEventBus.subscribe("showPagination",function(t){this.showPagination()}.bind(this))},getSortedData:function(t,e){return this.wfDefinitionCollection.sort(e,t),this.wfDefinitionCollection.toJSON()},showCreateInstanceForm:function(t){this.hideCreateInstanceForm(),this.options.regionEventBus.publish("hideBottomDivider","hideBottomDivider"),this.CreateWfInstanceForm=new b({minHeight:this.tableContentHeight,wfDefinitionModel:t,createHandledCallback:this.createHandledCallback.bind(this),regionEventBus:this.options.regionEventBus}),this.CreateWfInstanceForm.attachTo(this.view.getTableContent())},showHeader:function(t){this.view.getHeadingContent().setStyle("display","block")},hideCreateInstanceForm:function(){null!=this.CreateWfInstanceForm&&this.CreateWfInstanceForm.destroy(),this.CreateWfInstanceForm=null},createHandledCallback:function(t){this.hideCreateInstanceForm(),this.bpmnDiagram&&this.bpmnDiagram.destroy(),this.table?this.renderDefinitionTable():null!=this.table&&this.table.detach()},renderDefinitionTable:function(){var t=this.options.showAllVersions,i=this;a.getAllDefinitions({latest:!t,sortBy:"name",sortOrder:"asc",sortingMode:"asc",offset:this.offset,limit:this.limit,sortingAttribute:"category",success:function(t){this.wfDefinitionCollection=new e.Collection,t.each(function(t){var i=new e.Model;i.setAttribute("id",t.getAttribute("id")),i.setAttribute("name",t.getAttribute("name")),i.setAttribute("key",t.getAttribute("key")),i.setAttribute("version",t.getAttribute("version").toString()),i.setAttribute("category",t.getAttribute("category")),i.setAttribute("description",t.getAttribute("description")),i.setAttribute("createdOnStr",t.getAttribute("createdOnStr")),this.wfDefinitionCollection.addModel(i)}.bind(this)),i.filterTableData=this.wfDefinitionCollection,this.table.setData(this.wfDefinitionCollection.toJSON()),this.table.attachTo(this.view.getTableContent())}.bind(this)})},showPagination:function(){this.hidePagination(),s.getDefinitionCount({latest:!0,success:function(t){var e=Math.ceil(t/22);this.pagination=new o({pages:e,onPageChange:function(t){var e=22*(t-1);this.refresh({offset:e,limit:22})}.bind(this)}),this.pagination.attachTo(this.view.getPagination())}.bind(this)})},hidePagination:function(){null!=this.pagination&&(this.pagination.destroy(),this.pagination=null)},refresh:function(t){this.limit=t.limit,this.offset=t.offset,this.renderDefinitionTable()}})});