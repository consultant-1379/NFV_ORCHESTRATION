/* Copyright (c) Ericsson 2015 */

define("styles!widget/WfUsertasks/TaskFormOnDrilldown/TaskFormOnDrilldown.less",function(){return".eaNFE_automation_UI-TaskFormOnDrilldown {\n  width: 100%;\n}\n.eaNFE_automation_UI-TaskFormOnDrilldown-UsertasksToggle {\n  display: block;\n}\n.eaNFE_automation_UI-TaskFormOnDrilldown-Buttons {\n  padding-top: 10px;\n  background-color: #f2f2f2;\n  padding: 6px 0;\n  padding-left: 65px;\n  width: 185px;\n}\n.eaNFE_automation_UI-TaskFormOnDrilldown-ButtonsToggle {\n  display: block;\n  margin-top: 1%;\n  padding-bottom: 10px;\n}\n.eaNFE_automation_UI-TaskFormOnDrilldown-ButtonsToggle-Buttons {\n  padding-top: 10px;\n}\n.eaNFE_automation_UI-TaskFormOnDrilldown-Taskheading {\n  font-size: 2rem;\n  padding-top: 15px;\n  padding-bottom: 10px;\n  color: #89ba17;\n}\n"}),define("template!widget/WfUsertasks/TaskFormOnDrilldown/TaskFormOnDrilldown.html",["jscore/handlebars/handlebars"],function(t){return t.template(function(t,n,e,o,i){e=e||t.helpers;var a,s,r="",l="function",d=e.helperMissing,u=void 0,m=this.escapeExpression;return r+='<div class="eaNFE_automation_UI-TaskFormOnDrilldown">\r\n	<div class="eaNFE_automation_UI-TaskFormOnDrilldown-ButtonsToggle">\r\n 	<div class="eaNFE_automation_UI-TaskFormOnDrilldown-Panel">\r\n	    <h2 class="eaNFE_automation_UI-TaskFormOnDrilldown-Taskheading">',s=e.taskname,a=s||n.taskname,typeof a===l?a=a.call(n,{hash:{}}):a===u&&(a=d.call(n,"taskname",{hash:{}})),r+=m(a)+'</h2>\r\n    	<div class="eaNFE_automation_UI-TaskFormOnDrilldown-Panel-FormContent"></div>\r\n 	</div>\r\n 	\r\n 	<div class="eaNFE_automation_UI-TaskFormOnDrilldown-Buttons">\r\n        <button type="button" class="ebBtn ebBtn_color_paleBlue eaNFE_automation_UI-TaskFormOnDrilldown-buttonSubmit" title="Execute and complete task">Submit</button>\r\n        <button type="button" class="ebBtn ebBtn_wMargin eaNFE_automation_UI-TaskFormOnDrilldown-buttonCancel" title="Cancel">Cancel</button>\r\n 	</div>\r\n 	</div>\r\n</div>'})}),define("widget/WfUsertasks/TaskFormOnDrilldown/TaskFormOnDrilldownView",["jscore/core","template!./TaskFormOnDrilldown.html","styles!./TaskFormOnDrilldown.less"],function(t,n,e){return t.View.extend({getTemplate:function(){return n(this.options)},getStyle:function(){return e},getFormContent:function(){return this.getElement().find(".eaNFE_automation_UI-TaskFormOnDrilldown-Panel-FormContent")},getSubmitButton:function(){return this.getElement().find(".eaNFE_automation_UI-TaskFormOnDrilldown-buttonSubmit")},getCancelButton:function(){return this.getElement().find(".eaNFE_automation_UI-TaskFormOnDrilldown-buttonCancel")},getTaskNameHandleBar:function(){return this.getElement().find(".eaNFE_automation_UI-TaskFormOnDrilldown-Taskheading")},getUserActivityContent:function(){return this.getElement().find(".eaWorkflowInstanceN-MainRegion-contentWfInstanceN-home-UserActivity")},getUserActivityContent2:function(){return this.getElement().find(".eaWorkflowInstanceN-MainRegion-contentWfInstanceN-home-UserActivity2")},getButtonsToggle:function(){return this.getElement().find(".eaNFE_automation_UI-TaskFormOnDrilldown-ButtonsToggle")},getContentToggle:function(){return this.getElement().find(".eaNFE_automation_UI-WfForm-contentToggle")}})}),define("widget/WfUsertasks/TaskFormOnDrilldown/TaskFormOnDrilldown",["jscore/core","./TaskFormOnDrilldownView","3pps/wfs/WfUsertaskClient","3pps/wfs/WfInstanceClient","../../WfForm/WfForm","../../ErrorDialog/ErrorDialog","jscore/ext/locationController"],function(t,n,e,o,i,a,s){return t.Widget.extend({View:n,onAttach:function(){var t=this.options.wfUsertaskModel.getAttribute("workflowName");this.view.getTaskNameHandleBar().setText(t)},onViewReady:function(){this.wfUsertaskModel=this.options.wfUsertaskModel,this.taskHandledCallback=this.options.taskHandledCallback,this.usertaskId=this.options.wfUsertaskModel.getAttribute("id"),this.usertaskName=this.wfUsertaskModel.getAttribute("name"),this.workflowInstanceId=this.options.wfUsertaskModel.getAttribute("workflowInstanceId"),this.getAndRenderForm(this.usertaskId,this.workflowInstanceId),this.options.minHeight&&this.getElement().setStyle("min-height",this.options.minHeight)},getAndRenderForm:function(n,o){e.getFormModelByUsertaskId({usertaskId:n,success:function(n){var e=this.view.getCancelButton();e.addEventHandler("click",function(){this.view.getButtonsToggle().setStyle("display","none"),this.trigger("toggleContentDrilldown","toggledrilldown")}.bind(this));var o=this.view.getSubmitButton();o.addEventHandler("click",function(){this.taskHandledCallback=this.options.taskHandledCallback,this.handleSubmit(n)}.bind(this)),null!=n&&(null!=n&&(n.toString().indexOf("\n")>-1||"json"!=n.attributes.formInfo.format)?n.toString().indexOf("\n")>-1&&n.indexOf("")>=0&&(this.newFormElement=t.Element.parse(n),this.view.getFormContent().append(this.newFormElement)):(null!=n.getAttribute("cancelText")&&e.setText(n.getAttribute("cancelText")),null!=n.getAttribute("submitText")&&o.setText(n.getAttribute("submitText")),this.getVariablesAndRenderForm(n)))}.bind(this),error:function(t){this.handleError('Unable to retrieve form for "'+this.usertaskName+'"',[t])}.bind(this)})},getVariablesAndRenderForm:function(t){o.getVariables({wfInstanceId:this.workflowInstanceId,success:function(n){try{this.form=new i({formModel:t,variableCollection:n}),this.form.attachTo(this.view.getFormContent())}catch(e){this.handleError("Unable to build form for "+this.usertaskName,[e])}}.bind(this),error:function(t){this.handleError('Unable to retrieve variables for "'+this.usertaskName+'"',[t])}.bind(this)})},handleSubmit:function(t){var n=Object.create(null),i="";o.getTORUserId({success:function(t){i=t;var o=Object.create(null);o.value=i,o.required=!0,this.form&&(n=this.form.getVariables()),n["tor-user-id"]=o,null!=n&&e.completeUsertaskById({usertaskId:this.usertaskId,variables:n,success:function(){this.taskHandledCallback(!0)}.bind(this),error:function(t){this.handleError('Unable to complete task  "'+this.usertaskName+'"',[t])}.bind(this)})}.bind(this)})},handleCancel:function(){this.taskHandledCallback(!1)},handleError:function(t,n){var e=" ";if(null!=n&&n.length>0)for(var o=0;o<n.length;o++)e+=n[o]+" ";new a({title:t,message:e}),this.taskHandledCallback(!1)}})});