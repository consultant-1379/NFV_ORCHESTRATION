/* Copyright (c) Ericsson 2015 */

define("styles!widget/WfUsertasks/TaskForm/TaskForm.less",function(){return".eaNFE_automation_UI-TaskForm {\n  padding-right: 10px;\n  width: 99%;\n}\n.eaNFE_automation_UI-TaskForm-Buttons {\n  padding-top: 10px;\n  background-color: #f2f2f2;\n  background-size: 25%;\n  padding: 6px 0;\n  padding-left: 10px;\n  padding-left: 80px;\n  width: 200px;\n}\n.eaNFE_automation_UI-TaskForm-InfoPanel-Map {\n  height: 450px;\n  display: inline-block;\n  margin-top: 20px;\n  visibility: hidden;\n}\n.ebLayout-SectionSubheading {\n  font-size: 2rem;\n  padding-top: 8px;\n  padding-bottom: 10px;\n}\n.eaWfs-Form-Readonly {\n  color: #999999;\n}\n"}),define("template!widget/WfUsertasks/TaskForm/TaskForm.html",["jscore/handlebars/handlebars"],function(t){return t.template(function(t,e,n,s,a){n=n||t.helpers;var i,o,r="",l="function",d=n.helperMissing,m=void 0,u=this.escapeExpression;return r+='<div class="eaNFE_automation_UI-TaskForm">\r\n 	<div class="eaNFE_automation_UI-TaskForm-Panel">\r\n	    <div class="ebLayout-SectionSubheading">',o=n.taskname,i=o||e.taskname,typeof i===l?i=i.call(e,{hash:{}}):i===m&&(i=d.call(e,"taskname",{hash:{}})),r+=u(i)+'</div>\r\n    	<div class="eaNFE_automation_UI-TaskForm-Panel-FormContent"></div>\r\n 	</div>\r\n 	<div class="eaNFE_automation_UI-TaskForm-Buttons">\r\n        <button type="button" class="ebBtn ebBtn_color_paleBlue eaNFE_automation_UI-TaskForm-buttonSubmit">Submit</button>\r\n        <button type="button" class="ebBtn ebBtn_wMargin eaNFE_automation_UI-TaskForm-buttonCancel">Cancel</button>\r\n 	</div>\r\n 	<div class="eaWfDemo-Usertasks-taskFormAndProgress">\r\n		<div class="eaNFE_automation_UI-Usertasks-contentTaskForm"></div>\r\n	    <div class="eaNFE_automation_UI-WfInstances-contentProgress"></div> 	 \r\n	</div>\r\n</div>'})}),define("widget/WfUsertasks/TaskForm/TaskFormView",["jscore/core","template!./TaskForm.html","styles!./TaskForm.less"],function(t,e,n){return t.View.extend({getTemplate:function(){return e(this.options)},getStyle:function(){return n},getFormContent:function(){return this.getElement().find(".eaNFE_automation_UI-TaskForm-Panel-FormContent")},getSubmitButton:function(){return this.getElement().find(".eaNFE_automation_UI-TaskForm-buttonSubmit")},getCancelButton:function(){return this.getElement().find(".eaNFE_automation_UI-TaskForm-buttonCancel")},getInfoPanel:function(){return this.getElement().find(".eaNFE_automation_UI-TaskForm-InfoPanel-Map")},getTaskNameHandleBar:function(){return this.getElement().find(".ebLayout-SectionSubheading")},getTaskFormContent:function(){return this.getElement().find(".eaNFE_automation_UI-Usertasks-contentTaskForm")}})}),define("widget/WfUsertasks/TaskForm/TaskForm",["jscore/core","3pps/wfs/WfUsertaskClient","3pps/wfs/WfInstanceClient","../../WfForm/WfForm","../../ErrorDialog/ErrorDialog","./TaskFormView"],function(t,e,n,s,a,i){return t.Widget.extend({View:i,onAttach:function(){var t=this.options.wfUsertaskModel.getAttribute("name");this.view.getTaskNameHandleBar().setText(t)},onViewReady:function(){this.wfUsertaskModel=this.options.wfUsertaskModel,this.taskHandledCallback=this.options.taskHandledCallback,this.usertaskId=this.options.wfUsertaskModel.getAttribute("id"),this.usertaskName=this.wfUsertaskModel.getAttribute("name"),this.workflowInstanceId=this.options.wfUsertaskModel.getAttribute("workflowInstanceId"),this.getAndRenderForm(),this.options.minHeight&&this.getElement().setStyle("min-height","300px")},getAndRenderForm:function(t,n){e.getFormModelByUsertaskId({usertaskId:this.usertaskId,success:function(t){var e=this.view.getCancelButton();e.addEventHandler("click",function(){this.handleCancel(),this.options.regionEventBus.publish("showHeaderActive","showHeaderActive")}.bind(this));var n=this.view.getSubmitButton();n.addEventHandler("click",function(){this.handleSubmit(t),this.options.regionEventBus.publish("showHeaderActive","showHeaderActive")}.bind(this)),null!=t&&(null!=t.getAttribute("cancelText")&&e.setText(t.getAttribute("cancelText")),null!=t.getAttribute("submitText")&&n.setText(t.getAttribute("submitText")),this.getVariablesAndRenderForm(t))}.bind(this),error:function(t){this.handleError('Unable to retrieve form for "'+this.usertaskName+'"',[t])}.bind(this)})},getVariablesAndRenderForm:function(t){n.getVariables({wfInstanceId:this.workflowInstanceId,success:function(e){try{this.form=new s({formModel:t,variableCollection:e}),this.form.attachTo(this.view.getFormContent())}catch(n){this.handleError("Unable to build form for "+this.usertaskName,[n])}}.bind(this),error:function(t){this.handleError('Unable to retrieve variables for "'+this.usertaskName+'"',[t])}.bind(this)})},showMap:function(){var t={EPG:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d608639.5237634394!2d-7.900877228572618!3d53.42380099321005!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x485c4979c808ca15%3A0x4d1f49710c177939!2sGarrycastle+Cottages!5e0!3m2!1sen!2sie!4v1399382552460",PGW:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d609379.7002018099!2d-7.831164160156298!3d53.37208086506881!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4867094acc51a4ed%3A0x977d48b6e6b2197f!2sEricsson!5e0!3m2!1sen!2sie!4v1399385721197",GW:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d612785.8806186015!2d-7.581850087768572!3d53.33623216625395!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x485b5e98212e5873%3A0xca7febf3aac3fc2d!2sUniversity+of+Limerick!5e0!3m2!1sen!2sie!4v1399386001969"},e=this.form.controlWidgets[0].libWidget;if(null!=e){var n=e.getValue().name;null==t[n]?this.view.getInfoPanel().setStyle("height","0px"):this.view.getInfoPanel().setStyle("height","450px"),this.view.getInfoPanel().setAttribute("src",t[n]);var s=this;e.addEventHandler("change",function(){n=e.getValue().name,null==t[n]?s.view.getInfoPanel().setStyle("height","0px"):s.view.getInfoPanel().setStyle("height","450px"),s.view.getInfoPanel().setAttribute("src",t[n])})}},handleSubmit:function(t){var s=Object.create(null),a="";n.getTORUserId({success:function(t){a=t;var n=Object.create(null);n.value=a,n.required=!0,this.form&&(s=this.form.getVariables()),s["tor-user-id"]=n,null!=s&&e.completeUsertaskById({usertaskId:this.usertaskId,variables:s,success:function(){this.taskHandledCallback(!0)}.bind(this),error:function(t){this.handleError('Unable to complete task  "'+this.usertaskName+'"',[t])}.bind(this)})}.bind(this)})},handleCancel:function(){this.taskHandledCallback(!1)},handleError:function(t,e){var n=" ";if(null!=e&&e.length>0)for(var s=0;s<e.length;s++)n+=e[s]+" ";new a({title:t,message:n}),this.taskHandledCallback(!1)}})});