/* Copyright (c) Ericsson 2014 */

define("jscore/ext/locationController",["../core"],function(e){"use strict";function t(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()+"-"+(new Date).getTime()}function n(e){this.handlers={},this.options=e,this._preventListeners=!1,this.init.apply(this,arguments),e&&e.namespace&&(this.namespace=e.namespace),this.autoUrlDecode=e&&void 0!==e.autoUrlDecode?e.autoUrlDecode:!0}return n.prototype={init:function(){},getLocation:function(){var e;if(this.autoUrlDecode){var t=window.location.hash;e=decodeURIComponent(t),"#"===e.charAt(0)&&(e=e.substr(1))}else e=location.href.substr(location.href.indexOf("#")+1);return e},getNamespaceLocation:function(){var e=this.getLocation();return this.namespace&&(e=e.substring(this.namespace.length+1)),e},setLocation:function(e,t,n){this._preventListeners=t?!0:!1,n?history.replaceState({},"","#"+e):window.location.hash=e},setNamespaceLocation:function(e,t,n){this.namespace&&(e=this.namespace+"/"+e),this.setLocation(e,t,n)},addLocationListener:function(e,n){var i=t();return this.handlers[i]=n?e.bind(n):e,i},removeLocationListener:function(e){delete this.handlers[e]},start:function(){this._execHandlers(),this._startListening()},_execHandlers:function(){var e=this.getLocation();if(e!==this.currentUrl)if(this.currentUrl=e,this._preventListeners)this._preventListeners=!1;else{var t=new RegExp("^"+this.namespace+"(?![a-zA-Z0-9])","i");if(this.namespace&&t.test(e)||!this.namespace){this.namespace&&(e=e.substring(this.namespace.length),"/"===e[0]&&(e=e.substring(1)));for(var n in this.handlers)this.handlers.hasOwnProperty(n)&&this.handlers[n](e)}}},_startListening:function(){this.listener=this._execHandlers.bind(this),this.listenerEvent=e.Window.addEventHandler("hashchange",this.listener)},stop:function(){delete this.currentUrl,e.Window.removeEventHandler(this.listenerEvent)}},n.extend=e.extend,n});