/* Copyright (c) Ericsson 2014 */

define("jscore/ext/binding",["jscore/core","jscore/ext/utils/base/underscore"],function(t,e){function n(t,e){return new r({get:function(){return t.get(e)},set:function(n){return t.set(e,n)},events:s(t,"change:"+e)})}var i=function(t){this.subscribe=t};i.extend=t.extend,i.prototype={map:function(t){return new i(function(e){this.subscribe(function(n){e(t(n))})}.bind(this))}};var s=function(t,e){return new i(function(n){t.addEventHandler(e,n)})},r=i.extend({constructor:function(t){this.subscribers=[],this.options=t,t.events&&t.get?(this.events=t.events.map(t.get),this.trigger(t.get()),this.events.subscribe(this.trigger.bind(this))):this.events=new i(function(){})},subscribe:function(t){e.isFunction(t)?this.events.subscribe(t):(this.subscribers.push(t),void 0!==this.value&&t.fn(this.value))},addSyncSource:function(t){t.subscribe({source:this,fn:function(e){this.value=e,this.options.set&&this.options.set(e),this.notifyExcept(t)}.bind(this)})},trigger:function(t){this.value!==t&&(this.value=t,this.notifyExcept())},notifyExcept:function(t){for(var e in this.subscribers){var n=this.subscribers[e];n.source!==t&&n.fn(this.value)}},bind:function(t){t.addSyncSource(this),this.addSyncSource(t)}}),u={text:function(t){return new r({set:t.setText.bind(t)})},value:function(t){return new r({get:t.getValue.bind(t),set:t.setValue.bind(t),events:s(t,"focusOut change paste cut input")})}},o={bindModel:function(t,i,s,r){var o=n(t,i),c=e.isFunction(r)?r:u[r],d=c(s);o.bind(d)},bindCollection:function(t,e,n){var i={},s={},r=function(t){var i=s[t.cid];i||(i=n(t),s[t.cid]=i),i.attachTo(e)},u=function(){t.each(r)},o=function(t){s[t.cid].destroy(),delete s[t.cid]},c=function(){for(var t in s)s[t].destroy(),delete s[t]};return u(),i.add=t.addEventHandler("add",r),i.remove=t.addEventHandler("remove",o),i.reset=t.addEventHandler("reset",function(){setData(t)}),i.sort=t.addEventHandler("sort",function(){for(var t in s)s[t].detach();u()}),function(){for(var e in i)t.removeEventHandler(e,i[e]);c()}},Bindable:r,modelAttribute:n,value:u.value,text:u.text,eventTargetObservable:s};return o.bind=o.bindModel,o});