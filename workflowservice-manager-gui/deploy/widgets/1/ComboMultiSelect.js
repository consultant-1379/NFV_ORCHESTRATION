/* Copyright (c) Ericsson 2014 */
define('text',{load:function(e){throw new Error('Dynamic load not allowed: '+e)}});define('styles',{load:function(e){throw new Error('Dynamic load not allowed: '+e)}});define('template',{load:function(e){throw new Error('Dynamic load not allowed: '+e)}});define('json',{load:function(e){throw new Error('Dynamic load not allowed: '+e)}});
define("text!widgets/ComboMultiSelect/_comboMultiSelect.html",[],function(){return'<div class="ebComboMultiSelect">\n    <textarea class="ebComboMultiSelect-textarea ebTextArea" autocomplete="off"></textarea>\n    <button type="button" class="ebComboMultiSelect-helper">\n        <span class="ebComboMultiSelect-iconHolder">\n            <i class="ebIcon ebIcon_small ebIcon_downArrow_10px eb_noVertAlign"></i>\n        </span>\n    </button>\n    <div class="ebComboMultiSelect-listHolder"></div>\n\n    <div class="ebComboMultiSelect-body"></div>\n</div>'}),define("widgets/ComboMultiSelect/ComboMultiSelectView",["jscore/core","text!./_comboMultiSelect.html"],function(t,e){"use strict";var i=".ebComboMultiSelect-";return t.View.extend({afterRender:function(){this.textarea=this.getElement().find(i+"textarea"),this.helper=this.getElement().find(i+"helper"),this.listHolder=this.getElement().find(i+"listHolder")},getTemplate:function(){return e},getTextArea:function(){return this.textarea},getHelper:function(){return this.helper},getListHolder:function(){return this.listHolder}})}),define("widgets/utils/textUtils",[],function(){"use strict";var t={getTextWidth:function(e,i){var s=t.getTextWidth.canvas||(t.getTextWidth.canvas=document.createElement("canvas")),n=s.getContext("2d");n.font=i;var l=n.measureText(e);return Math.round(l.width)}};return t}),define("widgets/utils/keyboardUtils",[],function(){"use strict";var t={},e={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},i=function(e,i){var s,n=e.originalEvent.keyCode;return Object.keys(i).some(function(e){return t[e.toUpperCase()]===n?(s=i[e],!0):void 0}),s?s(e):void 0},s=function(t,e){if(!t||!e)throw new Error("Missing event argument");return t.addEventHandler("keydown",function(t){return i(t,e)})},n=function(t,e){e&&t.removeEventHandler(e)};return Object.keys(e).forEach(function(i){Object.defineProperty(t,i,{value:e[i],writable:!1})}),t.addKeyHandler=s,t.removeKeyHandler=n,t}),define("text!widgets/ComboMultiSelect/selectList/_selectList.html",[],function(){return'<ul class="ebComboMultiSelectList"></ul>'}),define("widgets/ComboMultiSelect/selectList/SelectListView",["jscore/core","text!./_selectList.html"],function(t,e){"use strict";return t.View.extend({getTemplate:function(){return e}})}),define("template!widgets/ComboMultiSelect/selectList/item/_item.html",["jscore/handlebars/handlebars"],function(t){return t.template(function(t,e,i){i=i||t.helpers;var s,n,l="",o="function",c=i.helperMissing,r=void 0,d=this.escapeExpression;return l+='<li class="ebComboMultiSelectList-item">\n    <span class="ebComboMultiSelectList-itemTitle" title="',n=i.title,s=n||e.title,typeof s===o?s=s.call(e,{hash:{}}):s===r&&(s=c.call(e,"title",{hash:{}})),l+=d(s)+'">',n=i.name,s=n||e.name,typeof s===o?s=s.call(e,{hash:{}}):s===r&&(s=c.call(e,"name",{hash:{}})),l+=d(s)+'</span>\n    <i class="ebComboMultiSelectList-itemClose ebIcon ebIcon_close ebIcon_interactive"></i>\n</li>'})}),define("widgets/ComboMultiSelect/selectList/item/ItemView",["jscore/core","template!./_item.html"],function(t,e){"use strict";var i=".ebComboMultiSelectList-";return t.View.extend({getTemplate:function(){return e(this.options)},getCloseIcon:function(){return this.getElement().find(i+"itemClose")}})}),define("widgets/ComboMultiSelect/selectList/item/Item",["jscore/core","./ItemView"],function(t,e){"use strict";return t.Widget.extend({ITEM_CLOSE:"item:close",ITEM_SELECT:"item:select",view:function(){return new e(this.options.data)},onViewReady:function(){this.data={name:this.options.data.name,value:this.options.data.value,title:this.options.data.title},this.options.enabled===!1?this.disable():this.enable()},getData:function(){return this.data},getPosition:function(){return this.getElement().getPosition()},enable:function(){void 0===this._selectEvtId&&(this._selectEvtId=this.getElement().addEventHandler("click",function(){this.select()},this));var t=this.view.getCloseIcon();void 0===this._closeEvtId&&(this._closeEvtId=t.addEventHandler("click",function(){this.trigger(this.ITEM_CLOSE,this)},this)),this.getElement().addEventHandler("click",function(t){t&&t.stopPropagation&&t.stopPropagation(),this.select()}.bind(this)),this.getElement().removeModifier("disabled"),t.removeModifier("disabled","ebIcon")},disable:function(){this._selectEvtId&&(this._selectEvtId.destroy(),delete this._selectEvtId);var t=this.view.getCloseIcon();this._closeEvtId&&(this._closeEvtId.destroy(),delete this._closeEvtId),this.getElement().setModifier("disabled"),t.setModifier("disabled","","ebIcon")},select:function(t){t&&t.silent===!0||this.trigger(this.ITEM_SELECT,this),this.getElement().setModifier("active")},unselect:function(){this.getElement().removeModifier("active")}})}),define("widgets/ComboMultiSelect/selectList/SelectList",["jscore/core","./item/Item","widgets/utils/domUtils","./SelectListView"],function(t,e,i,s){"use strict";function n(t){var e=this._childItems.indexOf(t);-1!==e&&this._childItems.splice(e,1),t.destroy(),this.trigger(this.LIST_CHANGE)}function l(t){return this._childItems.some(function(e){return o(t,e.getData())})}function o(t,e){return t.name===e.name&&t.title===e.title&&t.value===e.value}function c(){var t=this.getElement().getPosition(),e=this._childItems[this._childItems.length-1];return{x:e?Math.floor(e.getPosition().right-t.left):0,y:e?Math.floor(e.getPosition().top-t.top):0}}return t.Widget.extend({LIST_CHANGE:"list:change",LIST_SELECT:"list:select",View:s,init:function(){this._childItems=[]},onViewReady:function(){this.setSelectCount(this.options.selectCount),this.setItems(this.options.items)},getItems:function(){var t=[];return this._childItems.forEach(function(e){t.push(e.getData())}),t},getLastItemPosition:function(){return c.call(this)},getLastItem:function(){return this._childItems[this._childItems.length-1]},emptyList:function(){this._childItems.forEach(function(t){t.destroy()}),this._childItems=[]},getSelectCount:function(){return this.selectCount},setSelectCount:function(t){this.selectCount=t,1===this.selectCount?this.getElement().setModifier("select","single"):this.getElement().removeModifier("select","single")},setItems:function(t){this.emptyList(),t=t||[],t.forEach(this.addItem.bind(this))},addItem:function(t){if(!l.call(this,t)){var i=new e({data:t,enabled:this.isEnabled()});i.addEventHandler(e.prototype.ITEM_SELECT,this.setSelectedItem,this),i.addEventHandler(e.prototype.ITEM_CLOSE,n,this),this.getSelectCount()===this._childItems.length&&this.removeItem(this.getLastItem()),this._childItems.push(i),i.attachTo(this.getElement()),this.trigger(this.LIST_CHANGE)}},isEnabled:function(){return this.enabled},enable:function(){this.enabled=!0,this._childItems.forEach(function(t){t.enable()})},disable:function(){this.enabled=!1,this._childItems.forEach(function(t){t.disable()})},selectPreviousItem:function(){var t=this._childItems.length;if(0!==t){if(void 0===this.selectedItem)return void this.getLastItem().select();var e=this._childItems.indexOf(this.selectedItem)-1,i=this._childItems[e>0?e:0];i.select()}},selectNextItem:function(){var t=this._childItems.length;if(0!==t){var e=this._childItems.indexOf(this.selectedItem)+1,i=this._childItems[e!==t?e:t-1];i.select()}},getSelectedItem:function(){return this.selectedItem},setSelectedItem:function(t){void 0!==this.selectedItem&&this.selectedItem.unselect(),this.selectedItem=t,this.trigger(this.LIST_SELECT)},removeItem:function(t){void 0!==t&&(t===this.getSelectedItem()&&this.setSelectedItem(void 0),n.call(this,t))}})}),define("widgets/ComboMultiSelect/ComboMultiSelect",["jscore/core","widgets/ItemsControl","./selectList/SelectList","../utils/keyboardUtils","widgets/utils/domUtils","../utils/textUtils","./ComboMultiSelectView"],function(t,e,i,s,n,l,o){"use strict";function c(){this.keyBoardControl.backspace=r.bind(this),this.keyBoardControl.delete=d.bind(this),this.keyBoardControl.arrow_left=h.bind(this),this.keyBoardControl.arrow_right=a.bind(this)}function r(){var t=m.call(this);if(0===t.start&&0===t.end){var e=this._selectList.getSelectedItem();void 0!==e?this._selectList.removeItem(e):this._selectList.setSelectedItem(this._selectList.getLastItem())}}function d(t){var e=this._selectList.getSelectedItem();void 0!==e&&(this._selectList.removeItem(e),t.preventDefault())}function h(){var t=m.call(this);0===t.start&&0===t.end&&this._selectList.selectPreviousItem()}function a(t){var e=m.call(this);if(0===e.start&&0===e.end){var i=this._selectList,s=i.getSelectedItem(),n=i.getLastItem();if(void 0===s||void 0===n)return;s===n?this._selectList.setSelectedItem(void 0):i.selectNextItem(),t.preventDefault()}}function u(t){var e=this.getFocusableElement(),i=n.getElementDimensions(e),s=this._selectList.getLastItemPosition(),o=s.y||4,c=s.x,r=o+22;if(t===!0||!this._textAreaInnerWidth){var d=parseInt(e.getStyle("padding-left")),h=parseInt(e.getStyle("padding-right"));this._textAreaInnerWidth=i.width-d-h-2}var a=l.getTextWidth(e.getValue()||e.getAttribute("placeholder"),e.getStyle("font")),u=this._textAreaInnerWidth-s.x,m=u<.2*this._textAreaInnerWidth;m&&1!==this._selectList.getSelectCount()&&(c=0,o+=16,r+=16,u=0);var f=Math.ceil((a-u)/this._textAreaInnerWidth);f+=m?-1:0,f>0&&(r+=16*f);var g=i.height!==r;return e.setStyle({"padding-top":o+"px",height:r+"px","text-indent":c+"px"}),g}function m(){var t=this.getFocusableElement();return{start:t.getProperty("selectionStart"),end:t.getProperty("selectionEnd")}}return e.extend({View:o,init:function(t){this.options=t||{},this._selectList=new i({selectCount:t?t.selectCount:void 0,items:this.options.value}),this._selectList.addEventHandler(i.prototype.LIST_CHANGE,function(){u.call(this)&&this.reRenderListIfNeeded(),this.trigger("change")},this),this._selectList.addEventHandler(i.prototype.LIST_SELECT,function(){this.getFocusableElement().focus()},this)},onControlReady:function(){c.call(this),this._selectList.attachTo(this.view.getListHolder());var e=this.options.value&&0!==this.options.value.length?"":this.options.placeholder;this.setPlaceholder(e),this._windowEvtId=t.Window.addEventHandler("resize",this.resize.bind(this))},onDOMAttach:function(){u.call(this)},onDestroy:function(){this._windowEvtId&&(t.Window.removeEventHandler(this._windowEvtId),delete this._windowEvtId)},resize:function(){u.call(this,!0)&&this.reRenderListIfNeeded()},setValue:function(t){void 0!==t&&this._selectList.setItems(t)},getValue:function(){return this._selectList.getItems()},getFocusableElement:function(){return this.view.getTextArea()},onFocusableElementInput:function(){u.call(this)},setPlaceholder:function(t){this.view.getTextArea().setAttribute("placeholder",t||"")},onEnable:function(){1===this._selectList.getSelectCount()&&void 0===this._keyDownEvtId&&(this._keyDownEvtId=this.getFocusableElement().addEventHandler("keydown",function(t){t.originalEvent.keyCode!==s.TAB&&1===this._selectList.getItems().length&&t.preventDefault()},this)),this._selectList.enable(),this.view.getTextArea().setAttribute("disabled",!1),this.view.getHelper().setAttribute("disabled",!1)},onDisable:function(){this._selectList.disable(),void 0!==this._keyDownEvtId&&(this.getFocusableElement().removeEventHandler(this._keyDownEvtId),delete this._keyDownEvtId),this.getFocusableElement().setAttribute("disabled",!0),this.view.getHelper().setAttribute("disabled",!0)},onItemSelected:function(t){this.getFocusableElement().setValue(""),this.getFocusableElement().focus(),this.setItems(this.options.items),this._selectList.addItem(t),this._selectList.setSelectedItem(void 0)}})}),define("widgets/ComboMultiSelect",["widgets/ComboMultiSelect/ComboMultiSelect"],function(t){return t});