/* Copyright (c) Ericsson 2015 */

define("3pps/bpmn/Bpmn",["jscore/base/jquery","3pps/bpmn/Transformer","3pps/bpmn/Renderer"],function(e,t,r){function n(){}n.prototype.renderUrl=function(t,r){var n=jQuery.Deferred(),i=this;return e.get(t).done(function(e){try{n.resolve(i.render(e,r))}catch(t){n.reject(t)}}).fail(function(e){n.reject(e)}),n},n.prototype.renderDiagram=function(e,t){t.xid&&null!=t.xid&&(i=t.xid);var n=new r(e);n.render(t),this.definitionRenderer=n,this.processDefinitions=e,this.options=t;var s=n.getSurface().getDimensions(),o=1,a=1;s&&(o=parseFloat(s.width),a=parseFloat(s.height));var p=Math.min((t.width||o)/o,(t.height||a)/a);return this.zoom(p),this},n.prototype.render=function(e,r){var n=(new t).transform(e);return this.bpmnXml=e,this.renderDiagram(n,r),this},n.prototype.zoom=function(t){var r=this.definitionRenderer.gfxGroup.getTransform(),n=1,i=1;r&&(n=r.xx,i=r.yy),this.definitionRenderer.gfxGroup.setTransform({xx:t,yy:t});var s=this.definitionRenderer.getSurface().getDimensions();return this.definitionRenderer.getSurface().setDimensions(+s.width/n*t,+s.height/n*t),e.each(this.getOverlays(),function(e,r){r.style.left=r.style.left.split("px")[0]/n*t+"px",r.style.top=r.style.top.split("px")[0]/i*t+"px",r.style.width=r.style.width.split("px")[0]/n*t+"px",r.style.height=r.style.height.split("px")[0]/i*t+"px"}),this},n.prototype.getOverlays=function(){return document.getElementsByClassName(i+"bpmnElement")},n.prototype.getOverlay=function(e){return document.getElementsByClassName(i+e)[0]},n.prototype.annotation=function(e){var t=this.getOverlay(e);if(!t)throw new Error("Element "+e+" does not exist.");return{addDiv:function(e,r){var n=("<div class='"+(r||[]).join(" ")+"'>"+e+"</div>",document.createElement("div"));n.innerHTML=e,n.className="";for(var i=0;i<r.length;i++)n.className+=" "+r[i];return t.appendChild(n)},setHtml:function(e){return t.html(e),this},addClasses:function(e){for(var r=0;r<e.length;r++)t.className+=" "+e[r];return this},removeClasses:function(e){for(var r=t.className.split(/ +/),n=[],i=0;i<r.length;i++){for(var s=!1,o=0;o<e.length;o++)if(r[i]===e[o]){s=!0;break}s===!1&&n.push(r[i])}for(var a="",i=0;i<n.length;i++)i>0&&(a+=" "),a+=n[i];return t.className=a,this}}},n.prototype.clearAnnotations=function(e,t){var r=this.getOverlay(e);return r.empty().removeClass((t||[]).join(" ")),r},n.prototype.clear=function(){this.definitionRenderer.gfxGroup.destroy(),e("#"+this.options.diagramElement).empty()};var i="";return n});