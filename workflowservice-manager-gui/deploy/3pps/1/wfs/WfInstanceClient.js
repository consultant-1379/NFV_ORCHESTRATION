/* Copyright (c) Ericsson 2015 */

define("3pps/wfs/WfInstanceClient",["jscore/core","jscore/ext/mvp","jscore/ext/net"],function(e,t,s){var n={};return n.getInstances=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");var s="/engine-rest/engine/default/history/process-instance?";if(null!=e.sortBy){if(-1==["startTime","endTime"].indexOf(e.sortBy))throw new Error("Invalid sortBy value: "+sortBy);if(s+="sortBy="+e.sortBy,null!=e.sortOrder){if(-1==["asc","desc"].indexOf(e.sortOrder))throw new Error("Invalid sortOrder value: "+sortOrder);s+="&sortOrder="+e.sortOrder}}null!=e.offset&&(s+="&firstResult="+e.offset),null!=e.limit&&(s+="&maxResults="+e.limit),null!=e.processDefinitionId&&(s+="&processDefinitionId="+e.processDefinitionId),null!=e.completed&&(s+="&finished="+e.completed),null!=e.active&&(s+="&unfinished="+e.active);var n=new t.Collection([],{url:s});n.fetch({success:function(s){var n=new t.Collection;s.each(function(e){var s=new t.Model;s.setAttribute("id",e.getAttribute("id")),s.setAttribute("definitionId",e.getAttribute("processDefinitionId")),s.setAttribute("startTime",e.getAttribute("startTime")),s.setAttribute("endTime",e.getAttribute("endTime")),s.setAttribute("superProcessInstanceId",e.getAttribute("superProcessInstanceId")),s.setAttribute("startActivityId",e.getAttribute("startActivityId")),n.addModel(s)}),e.success.call(this,n)},error:function(t){e.error&&e.error.call(this,t)}})},n.getSuspendedInstances=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");var s="/engine-rest/engine/default/process-instance?";null!=e.active&&(s+="&active="+e.active),null!=e.suspended&&(s+="&suspended="+e.suspended);var n=new t.Collection([],{url:s});n.fetch({success:function(s){var n=new t.Collection;s.each(function(e){var s=new t.Model;s.setAttribute("processInstanceIds",e.getAttribute("id")),n.addModel(s)}),e.success.call(this,n)},error:function(t){e.error&&e.error.call(this,t)}})},n.getSuspendedInstancesDetails=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");var s="/engine-rest/engine/default/history/process-instance?";if(null!=e.sortBy){if(-1==["startTime","endTime"].indexOf(e.sortBy))throw new Error("Invalid sortBy value: "+sortBy);if(s+="sortBy="+e.sortBy,null!=e.sortOrder){if(-1==["asc","desc"].indexOf(e.sortOrder))throw new Error("Invalid sortOrder value: "+sortOrder);s+="&sortOrder="+e.sortOrder}}null!=e.offset&&(s+="&firstResult="+e.offset),null!=e.limit&&(s+="&maxResults="+e.limit),null!=e.processDefinitionId&&(s+="&processDefinitionId="+e.processDefinitionId),null!=e.completed&&(s+="&finished="+e.completed),null!=e.unfinished&&(s+="&unfinished="+e.unfinished);var n="";null!=e.wfInstanceCollection&&(e.wfInstanceCollection.each(function(e){n+=e.getAttribute("processInstanceIds")+","}),n=n.substring(0,n.length-1),s+="&processInstanceIds="+n);var r=new t.Collection([],{url:s});r.fetch({success:function(s){var n=new t.Collection;s.each(function(e){var s=new t.Model;s.setAttribute("id",e.getAttribute("id")),s.setAttribute("definitionId",e.getAttribute("processDefinitionId")),s.setAttribute("startTime",e.getAttribute("startTime")),s.setAttribute("endTime",e.getAttribute("endTime")),s.setAttribute("superProcessInstanceId",e.getAttribute("superProcessInstanceId")),s.setAttribute("startActivityId",e.getAttribute("startActivityId")),n.addModel(s)}),e.success.call(this,n)},error:function(t){e.error&&e.error.call(this,t)}})},n.getInstancesCount=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");var s="/engine-rest/engine/default/history/process-instance/count?";null!=e.processDefinitionId&&(s+="&processDefinitionId="+e.processDefinitionId),null!=e.completed&&(s+="&finished="+e.completed),null!=e.active&&(s+="&unfinished="+e.active);var n=new t.Collection([],{url:s});n.fetch({success:function(t){var s=t._collection.models[0].getAttribute("count");e.success.call(this,s)},error:function(e,t,s){s.error&&s.error.call(this,t)}})},n.getVariables=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");if(null==e.wfInstanceId||""==e.wfInstanceId)throw new Error("wfInstanceId missing");var n="/engine-rest/engine/default/process-instance/"+e.wfInstanceId+"/variables";s.ajax({url:n,type:"GET",dataType:"json",success:function(s){var n=new t.Collection;if(null!=s)for(var r in s){var i=new t.Model;i.setAttribute("name",r),i.setAttribute("type",s[r].type),i.setAttribute("value",s[r].value),n.addModel(i)}e.success.call(this,n)},error:function(t){e.error&&e.error.call(this,t)}})},n.startInstanceById=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");if(null==e.wfDefinitionId||""==e.wfDefinitionId)throw new Error("wfDefinitionId missing");var n="/engine-rest/engine/default/process-definition/"+e.wfDefinitionId+"/start",r={variables:e.variables};s.ajax({url:n,type:"POST",data:JSON.stringify(r),dataType:"json",contentType:"application/json;charset=UTF-8",processData:!1,success:function(s){var n=new t.Model;null!=s&&n.setAttribute("workflowInstanceId",s.id),e.success.call(this,n)},error:function(t){e.error&&e.error.call(this,t)}})},n.getInstanceById=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");if(null==e.wfDefinitionId||""==e.wfDefinitionId)throw new Error("wfDefinitionId missing");var n="/engine-rest/engine/default/process-instance/count?active=true&processDefinitionId="+e.wfDefinitionId,r={variables:e.variables};s.ajax({url:n,type:"GET",data:JSON.stringify(r),dataType:"json",contentType:"application/json;charset=UTF-8",processData:!1,success:function(s){var n=new t.Model;null!=s&&n.setAttribute("workflowInstanceId",s.id),e.success.call(this,n)},error:function(t){e.error&&e.error.call(this,t)}})},n.getActiveTasks=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");if(null==e.processInstanceId||""==e.processInstanceId)throw new Error("processDefinitionId missing");var s="/engine-rest/engine/default/history/activity-instance?&unfinished=true&activityType=userTask&processInstanceId="+e.processInstanceId,n=new t.Collection([],{url:s});n.fetch({success:function(t){e.success(t.toJSON())},error:function(t){e.error&&e.error.call(this,t)}})},n.getTORUserId=function(e){if(e=e||{},null==e.success)throw new Error("success callback missing");var t="../workflowservice-ext/rest/nfv_resource/getTORUserId";s.ajax({url:t,type:"GET",dataType:"text",success:function(t){null!=t&&e.success.call(this,t)},error:function(t){e.error&&e.error.call(this,t)}})},n});